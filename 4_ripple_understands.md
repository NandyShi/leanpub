# 理解ripple
## 简介
ripple是一个应用于金融事务的互联网协议。它维护了一个公共帐簿，包含所有参与者的账户信息，从而相隔多远交易都成为可能。原本需要数天才能完成的支付和清算，现在只需几秒就可以了，更快捷。它也让跨币种支付变的异常简单。
 ![A1_01](https://ripple.com/wiki/images/f/fc/A1_01.png)

 上图是ripple系统的简单示意图。
 最上面的RTXP即ripple协议，它运行在整个瑞波网络上，也就是全世界的瑞波p2p节点，所有的节点通过该协议从总帐上获得信息，写入信息。

 第二层代表ripple的总帐簿，可以把它理解为一个分布式的数据系统，存储着所有的账户和交易信息。它的存在使得大家可以像平常银行里查询转帐付款一样，进行各种操作。
 
 第三层为和用户紧密相关的一些概念。
 
  - 地址。每个用户都有一个ripple地址，系统要求所有和该地址相关的操作，都需要用该用户的私钥加密
。
  - 信任链。每个用户可以信任另一个用户，这样另一用户就可以和你共享你的货币。
  - 兑换申请。每个用户可以向ripple系统提交申请，将一种货币的资金换成另一种。
 
在线总账可以说是ripple的核心，让我们来看看用户是如何和它交互的。

## 理解瑞波账簿
账簿本身由三个组件组成，即上图的地址，信任连，兑换申请。看上去很简单，它们具体都有什么作用呢？

**地址**。
地址是账簿最基本的组件，它唯一的标致了你在ripple系统中的身份。每个ripple账户都有一个唯一的地址，其中保存了账户什么币种有多少结余等信息。这有两个意思。一是别人可以通过该地址给你付款。二是由于瑞波账本是共享的，所以别人也能查询到该地址的一些信息，包括余额。

![A1_02](https://ripple.com/wiki/images/d/d4/A1_02.png)

Q> ##小思考
Q> 余额等算隐私吗？公布的话是利大于弊还是弊大于利?至少中国大陆民众官员财产公开的呼声挺高的，而这在ripple中根本不是问题，只需知道他的地址即可。

**信任链**。
信任链是瑞波中用来管理两个账户之间结余的机制。信任链可以连接任意两个地址，也可以随时建立和取消。 信任方 alice 建立一条信任链到受信任方 bob， 意味着 alice 允许 bob 替她保管她的钱。建立信任链时，还需要指定币种和数量，意味着bob只能为alice保管特定的币种，且数量不超过设定的上限。

![](https://ripple.com/wiki/images/f/f6/A1_03.png)
![](https://ripple.com/wiki/images/e/e2/A1_04.png)

为方便起见，信任双方的结余记录在受信任的一方。这是因为信任链表示的是 alice 的账户中 bob 保管的部分是多少。每个账户可以有多条信任链，ripple 客户端自动计算每个账户的资产净值。在下图中，bob 欠 alice 125 元而 alice 欠 charlie 50 元， 所以 alice 的资产净值是 75 元。

![](https://ripple.com/wiki/images/9/9d/A1_06.png)

**交换申请**。
瑞波中第三个重要概念是交易申请。只要账户中有余额就可以发起交换申请，从而将手中资产从一种货币兑换成另一种。申请时需要设置您期望的汇率。在下图中， alice发起申请希望将手中的美元换成欧元。

![](https://ripple.com/wiki/images/c/c8/A1_07.png)

**事务**。
瑞波系统自动调节信任链的结余，有三种方式。下图中我们用红色圆圈表示事务发生前的结余，红色箭头表示事务发生后的结余。
 - 被信任方从信任方借入一定资金。通过这种方式， bob 申称他欠有 alice 一笔资金。

![](https://ripple.com/wiki/images/4/4d/A1_08.png)

 - 信任方从被信任方赎回被借走资金。通过这种方式，alice 申称 bob 不再欠有她资金。

![](https://ripple.com/wiki/images/1/14/A1_10.png)

 - 结余可以在信任同一个网关的不同账户之间转移。通过这种方式，alice 申称 bob 不再欠她钱而是欠 charlie 等量的钱。

![](https://ripple.com/wiki/images/1/14/A1_10.png)

不同币种间的交换申请可以由第三方撮合，用两个同步的事务。 alice 的200美元转出给第三方，同时第三方转让150欧元给她。

 ![](https://ripple.com/wiki/images/b/b6/A1_11.png)

 这些最基本的概念支撑起了整个瑞波帐簿： 地址，交易链，交易申请和事务。通过合理使用这些基本组件，用户可以在瑞波中很简单的完成他们的支付任务。

## 理解瑞波生态系统
瑞波生态系统由四种角色组成，客户，商业机构，网关和做市商。任意的瑞波用户都可以作为任意角色使用，不需要特殊的地址或权限。判断某个用户扮演的是什么角色，主要看它和其他地址是什么关系，交易时起什么作用。下面我们依次讨论每个角色在瑞波系统中分别起什么作用。

**用户**。 alice，以及其他用户，使用瑞波并信任一个本地网关。如下图绿色所示。大多数用户只有一条对本地网关的信任链用来交易他们的本地货币。

**商人**。 bob，以及其他商人，也使用并信任一个本地网关。如下图蓝色所示。和他们的客户一样，大多数商人也只有一条对本地网关的信任链用来接收本地货币。

**网关**。 网关作为一个中间机构，被交易双方信任，所以可以代为保管双方的资金，这让快速的支付成为可能，即使交易双方不见面。 由于用户和商人信任网关而网关可以不信任任何人，网关就成了一个知名的枢纽和交易中心。每一个集群代表了一个本地的商业社区。

![](https://ripple.com/wiki/images/7/7c/A1_13.png)

这样的社区遍布世界，每一个都以各自的本地网关为中心，形成一个以本地货币为交易媒介的商业社区。

![](https://ripple.com/wiki/images/c/c9/A1_14.png)

**做市商**。 瑞波做市商连接这些分散各地的商业社区使它们成为一个整体。做市商信任多个网关，从一个网关中买余额然后在另一个网关中卖出。做市商的出现，建立了一条通路，让alice可以使用瑞波网络从任意的商人那购买商品而不需关心商人信任的是哪个网关，使用的是哪种货币。

![](https://ripple.com/wiki/images/b/b7/A1_16.png)

一旦找到一条买家和卖家间的通路，瑞波会自动调节信任链两方的余额。如下图所示，mark接收alice的美金，同时支付给bernard欧元，mark和bernard均可以从各自的网关处取现，alice的钱成功支付给了bernard。

![](https://ripple.com/wiki/images/f/f1/A1_17.png)

##商业集成
在现代商业社会，商人们已经通过不同支付网络的接收支付，著名的支付网络包括ACH，SWIFT或者卡系统。瑞波提供了简单的 JSON 接口让使用者可以方便的将他们现有业务接入到瑞波系统。通过接入瑞波系统，您可以监控自己的瑞波地址，所有的收入和支付都一目了然。

![](https://ripple.com/wiki/images/1/1b/A1_18.png)

**商人**。 商人可以创建自己的瑞波帐号然后信任一个本地网关。利用瑞波接口商人bob可以实时的结算alice的购物清单。

![](https://ripple.com/wiki/images/f/fd/A1_19.png)

**商人支付流程**。 对于服务于商人们的支付处理商来说，它们可以使用一个瑞波账户处理来自瑞波网络的支付就可以了。商人们不需要做任何流程上的变化。

![](https://ripple.com/wiki/images/9/92/A1_20.png)

**客户支付流程**。 对于服务于最终客户的商家而言，无论其是否提供了消费卡或会员体系，均可使用瑞波简化他们客户的支付行为。如果使用瑞波联合协议，托管的客户能像发电子邮件一样完成支付，甚至不需要其是基于瑞波系统完成支付。

![](https://ripple.com/wiki/images/e/e2/A1_21.png)

## 瑞波关系网
瑞波系统中的交易双方总是互相信任且愿意做交易的，通过信任链及信任链的传递将大家连在一起使得关系网任意两人间的支付都成为可能。

**客户**。大多数瑞波用户只和本地网关打交道。这一条信任链就足以让他们能和瑞波中的任意用户做交易，在他们看来，网关处理了所有的支付细节。

![](https://ripple.com/wiki/images/2/25/A1_22.png)

**商人**。同样，瑞波中的商人也只需和本地网关打交道。他们只需要订好商品价格并接受本地网关支持的货币付款即可。借助瑞波网络，商品可以销往全世界。

![](https://ripple.com/wiki/images/1/1a/A1_23.png)

**网关**。网关处理的事务总是本地的，所有的交易都发生在信任它的客户之间，这就让网关知道它所有的用户。同样，这也方便监控瑞波网络上的一些交易使得交易满足本地法律的要求。

![](https://ripple.com/wiki/images/1/18/A1_24.png)

**做市商**。做市商和不同的网关做交易从而提供额外的流动性。如果需要不同币种间的结算，他们需要满足本地法律要求。做市商信任多个网关，通常也意味着这些网关都是值得信任的，这就保证了每一个支付都由值得信任的客户组成。

![](https://ripple.com/wiki/images/1/17/A1_25.png)

## 多重交易
由于使用共享的总帐，即使4个角色同时参与交易，瑞波系统也能保证交易的原子性。每一个交易者只需知道和相信它的直接交易对手，但通过信任链您可以和世界上的任意瑞波用户交易。

![](https://ripple.com/wiki/images/a/ae/A1_26.png)